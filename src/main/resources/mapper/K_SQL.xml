<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="k">

	<select id="adlist" parameterType="Integer" resultType="hashmap">
		SELECT *,(SELECT COUNT(*) FROM boardview WHERE b_cate1 = 'ad') AS ADcount 
		FROM boardview WHERE b_cate1 = 'ad'
<!-- 		LIMIT #{page }, 10 -->
	</select>

	<select id="Qlist" parameterType="hashmap" resultType="hashmap">
		SELECT *,
		(SELECT COUNT(*) FROM boardview WHERE b_cate1='q') AS Qtotal, 
		(SELECT COUNT(*) FROM boardview WHERE b_cate1='q' AND b_cate2='연필') AS 'pencile', 
		(SELECT COUNT(*) FROM boardview WHERE b_cate1='q' AND b_cate2='샤프') AS '샤프', 
		(SELECT COUNT(*) FROM boardview WHERE b_cate1='q' AND b_cate2='볼펜') AS '볼펜', 
		(SELECT COUNT(*) FROM boardview WHERE b_cate1='q' AND b_cate2='만년필') AS '만년필', 
		(SELECT COUNT(*) FROM boardview WHERE b_cate1='q' AND b_cate2='형광펜') AS '형광펜', 
		(SELECT COUNT(*) FROM boardview WHERE b_cate1='q' AND b_cate2='기타') AS '기타'
		FROM boardview WHERE b_cate1 = 'q' 
		<if test="b_cate2 != null">AND b_cate2=#{b_cate2}</if>
<!-- 		LIMIT #{page }, 10 -->
	</select>

	<select id="adSearch" parameterType="hashmap" resultType="hashmap">
		SELECT * FROM boardview WHERE b_cate1 = #{b_cate1} 
		AND (b_title LIKE CONCAT('%',#{searchCont},'%') 
		OR b_content LIKE CONCAT('%',#{searchCont},'%'))
	</select>

	<insert id="joinReg" parameterType="hashmap">
		INSERT INTO login (l_id, l_nick, l_pw, l_email) VALUES (#{id}, #{nick}, #{pw1}, #{email})
	</insert>

	<select id="checkID" parameterType="String" resultType="Integer">
		SELECT COUNT(*) FROM login WHERE l_id=#{id}
	</select>

	<select id="checkNick" parameterType="String" resultType="Integer">
		SELECT COUNT(*) FROM login WHERE l_nick=#{nick}
	</select>

	<select id="checkPW" parameterType="String" resultType="Integer">
		SELECT COUNT(*) FROM login WHERE l_pw=#{pw} AND l_id=#{id}
	</select>

	<select id="login" parameterType="hashmap" resultType="hashmap">
	SELECT l_id, l_pw, l_nick, l_auth,
	(SELECT COUNT(l_nick) FROM boardview AS B
	WHERE B.l_nick=(SELECT l_nick FROM login AS L WHERE L.l_id=#{ID})) AS countB,
	(SELECT COUNT(l_nick) FROM comment AS B
	WHERE B.l_nick=(SELECT l_nick FROM login AS L WHERE L.l_id=#{ID})) AS countC
	FROM login WHERE l_id=#{ID} AND l_pw=#{PW}
	</select>

	
	<delete id="commDelete" parameterType="Integer">
		DELETE FROM comment WHERE c_no=#{c_no}
	</delete>

<!-- 	<select id="commShow" parameterType="Integer" resultType="hashmap"> -->
<!-- 		SELECT * FROM comment WHERE b_no=#{b_no} -->
<!-- 	</select> -->

	<insert id="commInsert" parameterType="hashmap">
		INSERT INTO comment (l_nick, b_no, c_content) VALUES (#{nick}, #{b_no}, #{ccontent})
	</insert>

	<select id="mylist" parameterType="String" resultType="hashmap">
		SELECT l_id, l_pw, l_nick,
		(SELECT COUNT(*) FROM boardview WHERE l_id=#{id}) AS countB,
		(SELECT COUNT(*) FROM comment WHERE l_id=#{id}) AS countC
		FROM login WHERE l_id=#{id};
	</select>
 
	<update id="nickUpdate" parameterType="hashmap">
		UPDATE login SET l_nick=#{renick} WHERE l_id=#{id}
	</update>

	<update id="pwModi" parameterType="hashmap">
		UPDATE login SET l_pw=#{pw2} WHERE l_id=#{id}
	</update>
	
	<select id="likeUp" parameterType="String" resultType="Integer">
		UPDATE comment SET c_like=c_like+1 WHERE c_no=#{c_no}
	</select>
</mapper>